# Atmos CLI configuration for GuardDuty component tests
# https://atmos.tools/cli/configuration

base_path: ""

components:
  terraform:
    base_path: "components/terraform"
    apply_auto_approve: true
    deploy_run_init: true
    init_run_reconfigure: true
    auto_generate_backend_file: true

stacks:
  base_path: "stacks"
  included_paths:
    - "orgs/**/*"
  excluded_paths:
    - "**/_defaults.yaml"
  name_pattern: "{tenant}-{stage}"

logs:
  file: "/dev/stderr"
  level: Info

templates:
  settings:
    enabled: true
    sprig:
      enabled: true
    gomplate:
      enabled: true

# Custom command to list test components
commands:
  - name: test-components
    description: "Show all virtual components configured for testing"
    steps:
      - atmos describe stacks --sections none --format json 2>/dev/null | jq -r 'keys[]' | sort -u
